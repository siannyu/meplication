<!DOCTYPE html>
<html>

<head>
    <!-- jQuery cdn -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- jQuery ui cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
        integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css"
        integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- bootstrap cdn -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <!-- momentjs cdn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
        integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <style>
        .check_card {
            border: red solid;
        }

        .char_card:hover {
            cursor: pointer;
        }
    </style>
    <header></header>
    <main>
        유니온 배치를 효율적으로 해주는 사이트 애드온 입니다.
        <hr>
        <div class="container">
            <textarea id="input" cols="100" rows="10"></textarea>
            <button id="btn_loadInfo" type="button">캐릭터 정보 가져오기</button>
        </div>
        <!-- <div class="row row-cols-1 row-cols-md-6 g-6">
            <div class="col">
                <div class="card">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">캐릭터 이름</h5>
                        <p class="card-text">직업</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">캐릭터 이름</h5>
                        <p class="card-text">직업</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">캐릭터 이름</h5>
                        <p class="card-text">직업</p>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">캐릭터 이름</h5>
                        <p class="card-text">직업</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="char_char" class="container row row-cols-1 row-cols-md-6 g-4"></div> -->
        <div>
            <div style="display: inline; width: 140px; height: 200px;">
                <div style="background-color: #f3f3f3; width: 138px; height: 126px; border-radius: 75px; text-align: center; vertical-align: middle; margin: 0px; display: inline-block;">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                    style="position: relative; left: -19px; top: -42px;">
                </div>
                <div style="text-align:center;">
                    <h5>캐릭터 이름</h5>
                    <p>직업</p>
                </div>
            </div>
            <div style="display: inline;">
                <div style="background-color: #f3f3f3; width: 138px; height: 126px; border-radius: 75px; text-align: center; vertical-align: middle; margin: 0px; display: inline-block;">
                    <img src="https://avatar.maplestory.nexon.com/Character/180/AFHFMMAHPGMEJCAMJNJKFLHKNGIEMAMFICNGDGFKBFNHEMJHAOEFGMIPMCEJBDIPPDHOJFIJPBOKNPIDMJLJJPGOMJLKBKLLLCNDDEDPBLIGEHFJKMKGADEHIEBBELKFAJKKNHPPPNEDHHMAKCAHKKPEIALDJOJCAEFNFOMEFMABCFIMCBKPFKCMAFGPFGLDPGOIFKMGIJFPABHDEPLMKDNFNLLCMFBFOENOMLEDMCEHNKHKEJEJFFNMENMMEFBM.png"
                        style="position: relative; left: -19px; top: -42px;">
                </div>
                <div>
                    <h5>캐릭터 이름</h5>
                    <p>직업</p>
                </div>
            </div>

        </div>
    </main>
    <script>
        // 캐릭터 닉네임 가져오기
        $('#input').on("paste", function (e) {
            var pasteText = (event.clipboardData || window.clipboardData).getData('text').split('\n');
            var idx, world;

            // 붙여넣기 작업취소
            e.preventDefault();
            for (i in pasteText) {
                let nickIdx = pasteText[i].indexOf('대표캐릭터는 10레벨 이상이어야 지정할 수 있습니다');
                let worldIdx = pasteText[i].indexOf('캐릭터 선택');
                if (nickIdx != -1) {
                    idx = i;
                }
                if (worldIdx != -1) {
                    world = pasteText[i].substring(worldIdx + 6, pasteText[i].length);
                    // \r개행 제거
                    if (world.indexOf('\r') != -1) {
                        world = world.substring(0, world.length - 1);
                    }
                }
            }
            // 원하는 정보 아니면 빠져나가기
            if (idx == undefined) return;

            let nick = pasteText[idx - 1].split(world);

            for (let i = 1; i < nick.length; i++) {
                if (nick[i].indexOf(nick[i - 1]) != -1) {
                    let prevNick = nick[i].substring(nick[i].indexOf(nick[i - 1]), nick[i - 1].length);
                    nick[i] = nick[i].replace(prevNick, '');
                }
            }

            var nickList = '';
            for (var i = 0; i < nick.length - 1; i++) {
                nickList += nick[i];
                if (i != nick.length - 2) {
                    nickList += '\n';
                }
            }
            $(this).val(nickList);
        });

        function char_card(char_info, nickList) {
            console.log(Object.keys(char_info).length);
            console.log(Object.values(char_info));
            for (var i = 0; i < Object.keys(char_info).length; i++) {
                let source = `
                <div class="col char_card">
                    <div class="card">
                        <img src="${Object.values(char_info)[i].img}"
                            class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">${Object.keys(char_info)[i]}</h5>
                            <p class="card-text">${Object.values(char_info)[i].level}</p>
                            <p class="card-text">${Object.values(char_info)[i].job}</p>
                        </div>
                    </div>
                </div>`

                $('#char_char').append(source);
            }
        }

        $('#btn_loadInfo').click(function () {
            console.log('ajax');

            let getNick = $('#input').val().split('\n');
            $.ajax({
                url: "https://meplication.koreasouth.cloudapp.azure.com/charInfo",
                type: "post",
                data: { 'nickList': String(getNick) },
                dataType: "json",
                timeout: 30000,
                beforeSend: function () {
                    $('.container').html(
                        `<div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>`);
                },
                success: function (res) {
                    console.log('success');
                    console.log(res);
                    char_card(res, getNick);
                },
                error: function (res) {
                    console.log('err');
                    console.log(res);
                    if (res.statusText == 'timeout') {
                        alert('연결시간 초과!')
                    }
                    $('.container').html('fail');
                }
            });
        });

        $(document).on('click', '.char_card', function () {
            console.log(this);
            // $(this).css()
        })

        // includeHTML
        $('header').load('/meplication/include/header.html')
    </script>
</body>

</html>